- [개요](#개요)
- [계층 종류](#계층-종류)
	- [애플리케이션 계층](#애플리케이션-계층)
	- [전송 계층](#전송-계층)
	- [인터넷 계층](#인터넷-계층)
	- [링크 계층](#링크-계층)
- [기타 용어](#기타-용어)
	- [캡슐화](#캡슐화)
	- [PDU](#PDU)
	- [CRC/체크섬](#CRC/체크섬-트레일러)
	- [OSI 7계층](#OSI-7계층)

## 개요
TCP/IP 계층은 장치들이 인터넷에서 데이터를 주고받을 때 쓰는 독립적인 프로토콜 집합.
## 계층 종류
### 애플리케이션 계층
서비스를 실질적으로 제공하는 계층
ex) HTTP, FTP, SMTP, SSH

### 전송 계층
애플리케이션 계층에서 받은 메시지를 세그먼트(TCP) 혹은 데이터그램(UDP)로 변환하여 데이터가 **오류없이 순서대로 전달되도록** 도움을 주는 계층
ex) TCP, UDP

### 인터넷 계층
전송 계층에서 받은 세그먼트나 데이터그램을 목적지로 전송하도록 **패킷화**하는 계층.
ex) IP, ICMP, ARP

### 링크 계층
데이터가 네트워크로 전송되는 방식을 정의하는 계층. 데이터링크 계층과 물리 계층을 합쳐 이르는 말.

---
## 기타 용어
### 캡슐화
데이터를 보낼 때 데이터가 각 계층을 지나면서 헤더가 붙는 과정. 비캡슐화는 캡슐화의 역과정.

### PDU
PDU(Protocol Data Unit)은 TCP/IP 4계층 기준으로 각 계층의 데이터 단위.  
제어 관련 정보를 포함한 **헤더**와 데이터를 의미하는 **페이로드**로 구성된다.  
* 애플리케이션: 메시지
* 전송: 세그먼트, 데이터그램
* 인터넷: 패킷
* 링크: 프레임(데이터링크), 비트(물리)
> [!NOTE]
> 세그먼트: 메시지를 적절한 크기로 분할한 조각  
> 패킷: 세그먼트에 Src IP와 Dest IP가 포함된 IP 헤더가 붙음  
> 프레임: MAC 주소 헤더와 CRC/체크섬 트레일러가 붙음  


### CRC/체크섬 트레일러
데이터의 무결성을 검증하기 위한 함수가 적용된 값이 있는 필드. 데이터 손상을 감지하는 역할.
* CRC: CRC-1, CRC-16 등의 알고리즘으로 데이터 전송 오류를 감지
* 체크섬: MD5, SHA-256 등의 알고리즘으로 데이터 무결성 검증

### OSI 7계층
**All People Seem To Need Data Processing**  
TCP/IP 4계층과 달리 7계층으로 나눔.
- 애플리케이션
	- 애플리케이션
	- 프레젠테이션: 정보의 표현 방식을 관리 및 암호화
	- 세션: 두 종단의 프로세스의 접속을 설정·유지·종료(관리), 데이터 전송 순서 결정
- 전송
- 네트워크: 패킷 전송 경로(routing) 관리
- 링크
	- 데이터링크
	- 물리
---
## 계층
### 애플리케이션 계층
HTTP, SMTP, SSH, FTP 등 이용자에게 서비스를 제공하는 계층
#### HTTP
HTTP(Hypertext Transfer Protocol)는 서버와 브라우저 사이에 데이터를 주고 받기 위해 설계된 프로토콜. 현재는 서버 사이에서도 쓰임.  
> [!note]  
> 1. 헤더를 통한 확장이 쉬움
> 2. Stateless. 연속되는 두 요청 사이에 상태값은 포함하지 않음

#### SSH
SSH(Secure Shell Protocol)는 비보안 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜.

#### FTP
FTP(File Transfer Protocol)는 노드 사이에서 파일을 전송하기 위한 프로토콜.  
현재는 보안 때문에 FTPS나 SFTP로 대체 중.

#### SMTP
전자메일용 프로토콜.(Simple Mail Transfer Protocol)

### 전송 계층
#### TCP
- 가상회선 패킷 교환 방식: 모든 패킷이 정해진 회선을 따라 순서대로 이동
- 오류검사
	- 재전송: 시간이 초과되면 서버는 전달되지 않은 데이터를 재전송
	- 체크섬: 송신된 데이터와 수신된 데이터의 체크섬을 비교해서 무결성 평가
- 헤더: 20~60 바이트로 가변적
#### UDP
- 데이터그램 패킷 교환 방식: 각 패킷의 이동 경로가 다르고 도착 순서도 다름
- 오류검사
	- 체크섬
- 헤더: 8바이트로 고정

#### TCP vs. UDP

|        | TCP       | UDP     |
| ------ | --------- | ------- |
| 패킷 교환  | 가상회선      | 데이터그램   |
| 신뢰성    | O         | X       |
| 오류검사   | 재전송, 체크섬  | 체크섬     |
| 도착 순서  | 순서대로      | X       |
| 헤더 길이  | 20~60 가변적 | 8바이트 고정 |
| 연결 보장  | O         | X       |
| 브로드캐스트 | X         | O       |
| 속도     | 느림        | 빠름      |

### 인터넷 계층
#### 개요
IP, ICMP, ARP가 대표적이며 전송 계층의 세그먼트나 데이터그램을 패킷화하여 전송

#### ICMP
Internet Control Message Protocol  
노트 사이에서 통신 정상 작동 여부를 확인하는 독립적 비연결형 프로토콜  

---
## TCP 연결

![[3-way.png]]
1. SYN: 클라이언트가 서버에 클라이언트의 ISN[^1]을 담아 SYN 전송
2. SYN+ACK: 서버가 클라이언트의 SYN을 수신하여 서버의 ISN을 클라이언트에 전송. 이 때, ACK 번호는 수신한 ISN+1.
3. ACK: 클라이언트가 서버의 ISN+1 값을 승인번호로 담아 ACK 신호를 서버에 전송

### 클라이언트와 서버의 상태
- 클라이언트
	- CLOSED
	- SYN-SENT: SYN 신호 보내고 직후, ACK 신호 대기
	- ESTABLISHED: SYN+ACK 수신 후 ACK 전송
- 서버
	- CLOSED
	- LISTEN: 클라이언트 요청 대기
	- SYN-RECEIVED: SYN 신호 수신 후 SYN+ACK 전송. 최종 ACK 수신 대기
	- ESTABLISHED: 최종 ACK 신호 수신

---
## TCP 연결 해제
### 단계
1. 클라이언트에서 서버로 FIN 패킷 전송 후, FIN_WAIT_1 상태 진입
2. 서버가 FIN 패킷 수신 후, 클라이언트에 ACK 전송과 동시에 CLOSE_WAIT 진입.
3. 클라이언트가 ACK 수신 후, FIN_WAIT_2 상태 진입
4. 서버가 LAST_ACK 상태가 되어 

[^1]: TCP 기반 통신에서 새 연결에 할당된 32비트 고유 번호